# 페이지폴트
- 프로세스가 참조하려는 주소가 가리키는 페이지가 물리 메모리인 RAM에 없을 때 발생하는 현상이다. <br>
- 운영체제는 설계 원칙에 따라 전체 프로세스의 메모리 내용을 디스크로부터 한 번에 RAM에 올리지 않고 <br>
처음에 필요한 부분들만 효율적으로 올리기 때문에 페이지 폴트 발생한다. <br>

## 페이지 폴트 이후의 과정
<img width="666" height="556" alt="a1 (2)" src="https://github.com/user-attachments/assets/99beedcf-1e5e-407a-9666-6ecc5d4d718a" /><br>
[이미지 출처](https://dailyheumsi.tistory.com/139)<br>
<img width="994" height="509" alt="a1 (4)" src="https://github.com/user-attachments/assets/b8ca940b-0040-4eb2-bb39-4996989dc36e" /><br>
[이미지 출처](https://blog.skby.net/%EC%8A%A4%EB%A0%88%EC%8B%B1-thrashing/)<br>
1. `참조 및 트랩`: CPU가 특정 주소를 참조했으나 해당 페이지가 물리 메모리에 없는 것을 발견하고, <br>
페이지 폴트 트랩을 발생시켜 운영체제에 제어권을 넘긴다. <br>
이때 운영체제는 해당 접근이 유효한지 확인하고, 비정상적인 접근이라면 프로세스를 강제 종료한다. <br>
2. `물리 메모리 확인`: 운영체제는 필요한 페이지를 로드하기 위해 물리 메모리에서 비어있는 프레임이 있는지 확인한다. <br> 
3. `백킹 스토어 확인`: 운영체제는 필요한 페이지가 보조 저장 장치인 백킹 스토어에 있는지 확인한다. <br>
4. `Swap-in 또는 페이지 교체`:<br>
빈 프레임이 있다면: 백킹 스토어에서 페이지를 가져와(Swap-in) 빈 프레임에 로드한다.<br>
빈 프레임이 없다면: 페이지 교체 알고리즘을 사용해 기존 페이지 하나를 백킹 스토어로 내보내고(Swap-out),
빈 공간에 새 페이지를 가져온다(Swap-in).<br>
5. `페이지 테이블 업데이트`: 물리 메모리에 로드된 페이지의 새로운 위치 정보를 페이지 테이블에 갱신한다.<br>
6.`명령 재시작`: 페이지 테이블 업데이트가 완료되면, 운영체제는 CPU에게 페이지 폴트를 일으켰던 명령어를 다시 실행하라고 알린다.<br>


- 페이지폴트로 인한 I/O 작업은 CPU의 효율성을 낮추는데, 이 때 평균 메모리 시간은 다음과 같이 계산될 수 있다.<br>
```text
p: Page Fault Rate
EAT: (1-p) * (메모리 접근 시간) + p * (page fault overhead +
swap in-out + restart overhead)
  ```

- 메모리 접근 시간: 수백 나노초(ns)
- 디스크 접근 시간: 수 밀리초(ms)
- Swap-in: 디스크->메모리
- Swap-out: 메모리->디스크

## 스레싱
<img width="421" height="267" alt="a1 (5)" src="https://github.com/user-attachments/assets/fcbf0e21-4add-4def-9d81-1ab9721284d5" /><br>
[이미지 출처](https://blog.skby.net/%EC%8A%A4%EB%A0%88%EC%8B%B1-thrashing/)<br>
- 실제 프로세스 실행보다 스와핑 작업에 대부분의 시간이 소요되는 현상이다.
- 하드웨어적으로 해결하는 방법으로는 메모리를 늘리거나 SDD로 바꾸는 것이고.
- 운영체제에서 해결하는 방법은 작업세트(Working Set)와 PFF(Page Fault Frequency) 등이 있다.

## Working Set
- 프로세스의 과거 사용이력을 기반으로 페이지 집합을 만들어 한꺼번에 미리 메모리에 로드하는 것이다.
- 자주 접근하는 페이지들이 이미 메모리에 존재하면 페이지 폴트의 발생 가능성이 줄어든다.

## PFF(Page Fault Frequency)
<img width="989" height="433" alt="a1 (6)" src="https://github.com/user-attachments/assets/6143e356-2f11-4d03-a530-800baab9e3cf" /><br>
[이미지 출처](https://blog.skby.net/%EC%8A%A4%EB%A0%88%EC%8B%B1-thrashing/)<br>
- 페이지 폴트 발생 빈도를 모니터링해서 메모리 프레임 할당량을 동적으로 조절하는 것이다.
- 상한선에 도달하면 더 많은 프레임을 할당하여 Working Set을 확장시킨다.
- 하한선에 도달하면 일부 프레임을 회수하여 다른 프로세스에 재할당한다.
























하드 디스크의 특정 영역으로 옮겨 저장하는 공간을 스왑 영역이라고 부른다. <br>
