# 가상메모리

```text
virtual memory는 컴퓨터가 실제로 이용가능한 메모리 자원을 추상화하여
이를 사용하는 사용자에게 매우 큰 메모리로 보이게 만드는 메모리 관리 기법이다.
단순히 그냥 커보이게만 하는 것이 아니라, 그 안에 들어가있는
페이지 테이블, MMU, TLB, 페이지폴트 등이 어우러진 시스템을 통틀어서 말한다.
```

## MMU
<img width="1012" height="350" alt="a1" src="https://github.com/user-attachments/assets/989b2b9b-e123-4f76-b41a-774210405f6d" /><br>
[이미지 출처](https://smarthammer.tistory.com/60)<br>
- MMU(Memory Management Unit) : CPU와 메모리 사이에 위치한 하드웨어 컴포넌트로, <br>
가상 주소와 물리 주소 사이의 변환(주소 변환)을 담당한다. <br>
프로그램이 가상 주소로 메모리에 접근하면 MMU는 이를 페이지 테이블에 기반해 실제 물리 주소로 <br>
변환하여 올바른 메모리 위치에 접근할 수 있도록 돕는다. <br>

- 페이지: 가상 메모리를 사용하는 최소 크기 단위이다.
- 프레임: 실제 메모리를 사용하는 최소 크기 단위이다.

## 페이지 테이블
<img width="1070" height="624" alt="a1 (1)" src="https://github.com/user-attachments/assets/11b7131d-7ffc-4fc9-ba94-9115e25d6af5" /> <br>
[이미지 출처](https://smarthammer.tistory.com/60)<br>
- 가상 메모리는 가상주소와 실제주소가 매핑되어있는 자료구조인 페이지 테이블로 관리된다.
- 이 때, 속도 향상을 위해 TLB를 사용한다.
- 가상주소에서 바로 페이지테이블을 가는 것이 아니라, TLB에서 중간 점검을 한다.

## 프로세스 A와 프로세스 B가 실행 및 종료시의 메모리 할당 과정
### 1. 프로세스 실행 (A와 B):
```text
process A의 가상 주소 0x0000 할당
process B의 가상 주소 0x1000 할당
```
- 운영체제는 각 프로세스에 독립적인 가상 주소 공간을 할당.
- MMU는 가상 주소를 물리 주소로 변환하는 페이지 테이블을 생성한다.
- 프로세스 실행 시, 메모리 보호를 통해 다른 프로세스의 메모리에 접근할 수 없도록 관리한다.
### 2. 프로세스 실행 중 (A와 B):
```text
0x0000->실제 물리 메모리 주소 0x2000에 매핑
0x1000->실제 물리 메모리 주소 0x3000에 매핑
```
- MMU는 가상 주소와 물리 주소 변환을 처리하며, TLB 캐시를 사용해 성능이 향상된다.
- 각 프로세스는 서로 독립적인 메모리 영역에서 실행된다.
### 3. 프로세스 종료 (A와 B):
```text
A와 B가 종료하고 메모리에서 해제된다.
```
- 종료된 프로세스의 페이지 테이블과 메모리가 회수되고, 다른 프로세스에 재사용될 수 있도록 반환한다.
힙, 스택 등 자원도 회수된다.

### 4. 종료 후 재실행
```text
프로세스 A의 가상 주소 0x0000할당 -> **물리적 매핑 시 0x4000에 매핑
프로세스 A의 가상 주소 0x1000할당 -> **물리적 매핑 시 0x5000에 매핑
```


